import{a as at,b as it,r as R,w as B,e as nt,f as N,h as E,t as lt,i as st,j as dt,o as j}from"./entry.00e73135.js";const ct={class:"h-full select-none"},rt=E("canvas",{id:"scene",class:"z-0 w-full h-full",style:{"image-rendering":"pixelated"}},null,-1),ht={class:"fixed top-5 right-5 bg text"},ft={key:0},yt=E("p",{class:"fixed top-10 right-5 text-lg bg text"},"GAME OVER",-1),gt=E("p",{class:"fixed top-16 right-5 text-xs bg text"},"Press X to restart",-1),xt=[yt,gt],wt=at({__name:"index",async setup(vt){let S,C;dt(t=>({bb4ba54a:G.value,"0b826a33":D.value})),it({title:"DitherSnake"});const o=16;let X=Math.floor(window.innerWidth/64),Y=Math.floor(window.innerHeight/64),i,n;const F=R(0),k=R(!1),q=10,G=R("rgb(0, 0, 0)"),D=R("rgb(255, 255, 255)"),e={x:0,y:0,velocityX:0,velocityY:0,tail:[],maxTail:1},h={index:0,x:1,y:1,particleFrame:0},f={velocityX:0,velocityY:0},m={startX:0,startY:0,endX:0,endY:0},l={index:0,light:[[255,255,255],[244,78,56],[199,199,199],[195,220,229],[237,246,214],[235,229,206],[114,164,136],[34,35,35]],dark:[[0,0,0],[29,15,68],[20,23,36],[17,12,34],[62,35,44],[46,48,55],[33,44,40],[240,246,240]]},A=new Image;A.src="./assets/floor_texture.png",[S,C]=B(()=>new Promise(t=>{A.onload=()=>t(1)})),await S,C();const O=new Image;O.src="./assets/food_atlas.png",[S,C]=B(()=>new Promise(t=>{O.onload=()=>t(1)})),await S,C();const K=new Image;K.src="./assets/particle_sprite.png",[S,C]=B(()=>new Promise(t=>{K.onload=()=>t(1)})),await S,C();const H=new Audio("./sfx/food.wav");H.volume=.1;const V=new Audio("./sfx/death.wav");V.volume=.3,document.addEventListener("touchstart",t=>{m.startX=t.touches[0].clientX,m.startY=t.touches[0].clientY,m.endX=t.touches[0].clientX,m.endY=t.touches[0].clientY}),document.addEventListener("touchmove",t=>{m.endX=t.touches[0].clientX,m.endY=t.touches[0].clientY}),document.addEventListener("touchend",t=>{let y=m.startX-m.endX,c=m.startY-m.endY;if(Math.abs(c)+Math.abs(y)<20){k.value&&z();return}Math.abs(c)>Math.abs(y)?c>0&&e.velocityY!=1?(f.velocityX=0,f.velocityY=-1):c<=0&&e.velocityY!=-1&&(f.velocityX=0,f.velocityY=1):Math.abs(c)<Math.abs(y)&&(y>0&&e.velocityX!=1?(f.velocityX=-1,f.velocityY=0):y<=0&&e.velocityX!=-1&&(f.velocityX=1,f.velocityY=0))}),nt(async()=>{i=document.getElementById("scene"),i.height=Y*o,i.width=X*o,n=i.getContext("2d"),await T(),document.addEventListener("keydown",$),window.addEventListener("resize",tt),setInterval(function(){W()},1e3/q)});async function W(){k.value||(n.drawImage(A,0,0,i.width,i.height),e.velocityX=f.velocityX,e.velocityY=f.velocityY,e.x+=e.velocityX,e.y+=e.velocityY,e.x<0?e.x=X-1:e.x>X-1&&(e.x=0),e.y<0?e.y=Y-1:e.y>Y-1&&(e.y=0),e.tail.unshift({x:e.x,y:e.y}),e.tail.length>e.maxTail&&e.tail.pop(),n.fillStyle="white",e.tail.forEach(function(t,y){n.fillRect(t.x*o,t.y*o,o,o),t.x===h.x&&t.y===h.y&&(H.play(),e.maxTail++,F.value++,e.tail.push([h.x,h.y]),T());for(let c=y+1;c<e.tail.length;c++)t.x==e.tail[c].x&&t.y==e.tail[c].y&&(V.play(),k.value=!0)}),U())}async function U(){const c=Math.floor(Math.random()*10+160),d=document.createElement("canvas");d.width=i.width,d.height=i.height;const s=d.getContext("2d");s.fillStyle="black",s.fillRect(0,0,i.width,i.height);const r=e.x*o+o/2,w=e.y*o+o/2;let x=s.createRadialGradient(r,w,0,r,w,c);x.addColorStop(0,"rgba(255, 255, 255, 255)"),x.addColorStop(.1,"rgba(206, 206, 206, 206)"),x.addColorStop(.2,"rgba(163, 163, 163, 163)"),x.addColorStop(.3,"rgba(125, 125, 125, 125)"),x.addColorStop(.4,"rgba(92, 92, 92, 92)"),x.addColorStop(.5,"rgba(64, 64, 64, 64)"),x.addColorStop(.6,"rgba(41, 41, 41, 41)"),x.addColorStop(.7,"rgba(23, 23, 23, 23)"),x.addColorStop(.8,"rgba(10, 10, 10, 10)"),x.addColorStop(.9,"rgba(2, 2, 2, 2)"),x.addColorStop(1,"rgba(0, 0, 0, 0)"),s.beginPath(),s.fillStyle=x,s.arc(r,w,c,0,2*Math.PI),s.fill();const g=h.x*o+o/2,u=h.y*o+o/2;let p=s.createRadialGradient(g,u,8,g,u,c/4);p.addColorStop(0,"rgba(255, 255, 255, 255)"),p.addColorStop(1,"rgba(255, 255, 255, 0)"),s.fillStyle=p,s.arc(g,u,c/3,0,2*Math.PI),s.fill();let P=J(r,w,g,u,165+5),M=s.getImageData(0,0,d.width,d.height);for(let a=0;a<M.data.length;a+=4){const v=P.data[a]/255;M.data[a]*=v}let _=n.getImageData(0,0,i.width,i.height);for(let a=0;a<_.data.length;a+=4){const v=M.data[a]/255;_.data[a]*=v,_.data[a+1]*=v,_.data[a+2]*=v}n.putImageData(_,0,0),n.drawImage(O,h.index*o,0,o,o,h.x*o,h.y*o,o,o);let I=n.getImageData(0,0,i.width,i.height);I=Z(I,128),n.putImageData(I,0,0),h.particleFrame++,h.particleFrame>25&&(h.particleFrame=0),n.drawImage(K,h.particleFrame*o,0,o,o*2,h.x*o,(h.y-3)*o,o,o*2);const b=Math.floor(c/4);if(n.strokeStyle=D.value,n.lineWidth=2,g+b>i.width){let a=g+b-i.width;n.beginPath(),n.moveTo(i.width,u-a),n.lineTo(i.width,u+a),n.stroke()}if(g-b<0){let a=g-b;n.beginPath(),n.moveTo(0,u-a),n.lineTo(0,u+a),n.stroke()}if(u+b>i.height){let a=u+b-i.height;n.beginPath(),n.moveTo(g-a,i.height),n.lineTo(g+a,i.height),n.stroke()}if(u-b<0){let a=u-b;n.beginPath(),n.moveTo(g-a,0),n.lineTo(g+a,0),n.stroke()}}function J(t,y,c,d,s){const r=Q(t,y,c,d,8),w=r[0].x-t,x=r[0].y-y,g=Math.hypot(w,x),u=r[1].x+w/g*s,p=r[1].y+x/g*s,P=r[1].x-t,M=r[1].y-y,_=Math.hypot(P,M),I=r[1].x+P/_*s,b=r[1].y+M/_*s,a=document.createElement("canvas");a.width=i.width,a.height=i.height;const v=a.getContext("2d");v.fillStyle="#FFFFFF",v.fillRect(0,0,i.width,i.height),v.beginPath(),v.moveTo(r[0].x,r[0].y),v.lineTo(u,p),v.lineTo(I,b),v.lineTo(r[1].x,r[1].y),v.closePath();const et=(g/(s/2)-1)*255,L=Math.min(Math.max(et,100),255),ot="rgb("+L+", "+L+", "+L+")";return v.filter="blur(4px)",v.fillStyle=ot,v.fill(),v.getImageData(0,0,a.width,a.height)}function Q(t,y,c,d,s){const r=c-t,w=d-y,x=Math.sqrt(r*r+w*w),g=Math.asin(s/x),u=Math.atan2(w,r);let p=u-g;const P={x:c+s*Math.sin(p),y:d+s*-Math.cos(p)};p=u+g;const M={x:c+s*-Math.sin(p),y:d+s*Math.cos(p)};return[P,M]}function Z(t,y){const c=[[15,135,45,165],[195,75,225,105],[60,180,30,150],[240,120,210,90]];for(let d=0;d<t.data.length;d+=4){const s=t.data[d]*.299+t.data[d+1]*.587+t.data[d+2]*.114,r=d/4%t.width,w=Math.floor(d/4/t.width);Math.floor((s+c[r%4][w%4])/2)>=y?(t.data[d]=l.light[l.index][0],t.data[d+1]=l.light[l.index][1],t.data[d+2]=l.light[l.index][2]):(t.data[d]=l.dark[l.index][0],t.data[d+1]=l.dark[l.index][1],t.data[d+2]=l.dark[l.index][2])}return t}async function T(){let t=!1;for(;!t;)h.x=Math.floor(Math.random()*X),h.y=Math.floor(Math.random()*Y),t=!0,e.tail.forEach(function(y){y.x===h.x&&y.y===h.y&&(t=!1)});h.index=Math.floor(Math.random()*5)}function $(t){(t.code==="ArrowUp"||t.code==="KeyW")&&e.velocityY!=1?(f.velocityX=0,f.velocityY=-1):(t.code==="ArrowDown"||t.code==="KeyS")&&e.velocityY!=-1?(f.velocityX=0,f.velocityY=1):(t.code==="ArrowLeft"||t.code==="KeyA")&&e.velocityX!=1?(f.velocityX=-1,f.velocityY=0):(t.code==="ArrowRight"||t.code==="KeyD")&&e.velocityX!=-1&&(f.velocityX=1,f.velocityY=0),k.value&&t.code==="KeyX"&&z(),t.code==="KeyC"&&(l.index++,l.index>=l.light.length&&(l.index=0),G.value="rgb("+l.dark[l.index][0]+", "+l.dark[l.index][1]+", "+l.dark[l.index][2]+")",D.value="rgb("+l.light[l.index][0]+", "+l.light[l.index][1]+", "+l.light[l.index][2]+")")}async function z(){F.value=0,k.value=!1,e.x=e.y=e.velocityX=e.velocityY=0,e.maxTail=1,e.tail=[],f.velocityX=f.velocityY=0,T()}function tt(){X=Math.floor(window.innerWidth/64),Y=Math.floor(window.innerHeight/64),i.height=Y*o,i.width=X*o,h.x>X-1&&T(),h.y>Y-1&&T(),W()}return(t,y)=>(j(),N("div",ct,[rt,E("p",ht,"SCORE - "+lt(F.value),1),k.value?(j(),N("div",ft,xt)):st("",!0)]))}});export{wt as default};
