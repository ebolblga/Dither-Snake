import{a as W,b as N,r as A,w as E,e as V,f as R,h as f,t as G,u as O,i as U,o as K}from"./entry.914971e1.js";const j={class:"h-full select-none"},q=f("canvas",{id:"scene",class:"z-0 w-full h-full",style:{"image-rendering":"pixelated"}},null,-1),J={class:"fixed top-6 right-4 text-black"},Q={class:"fixed top-5 right-5"},Z={key:0},$=f("p",{class:"fixed top-11 right-4 text-black text-lg"},"Game over",-1),tt=f("p",{class:"fixed top-10 right-5 text-lg"},"Game over",-1),et=f("p",{class:"fixed top-16 right-4 text-black text-xs"},"Press X to restart",-1),ot=f("p",{class:"fixed top-16 right-5 text-xs"},"Press X to restart",-1),at=[$,tt,et,ot],lt=W({__name:"index",async setup(it){let _,M;N({title:"Snake"});let o=16,r=Math.floor(window.innerWidth/64),h=Math.floor(window.innerHeight/64),i,d;const X=A(0);let x=A(!1);const Y=new Image;Y.src="./assets/floor.png",[_,M]=E(()=>new Promise(e=>{Y.onload=()=>e(1)})),await _,M();const b=new Image;b.src="./assets/food_atlas.png",[_,M]=E(()=>new Promise(e=>{b.onload=()=>e(1)})),await _,M();const C=new Audio("./sfx/food.wav");C.volume=.1;const D=new Audio("./sfx/death.wav");D.volume=.3;const c={velocityX:0,velocityY:0},t={x:0,y:0,velocityX:0,velocityY:0,tail:[],maxTail:1},n={index:0,x:1,y:1};V(async()=>{i=document.getElementById("scene"),i.height=h*o,i.width=r*o,d=i.getContext("2d"),await u(),document.addEventListener("keydown",F),window.addEventListener("resize",T),setInterval(function(){P()},100)});function T(){r=Math.floor(window.innerWidth/64),h=Math.floor(window.innerHeight/64),i.height=h*o,i.width=r*o,n.x>r-1&&u(),n.y>h-1&&u(),P()}async function P(){x.value||(d.drawImage(Y,0,0,i.width,i.height),d.drawImage(b,n.index*o,0,o,o,n.x*o,n.y*o,o,o),t.velocityX=c.velocityX,t.velocityY=c.velocityY,t.x+=t.velocityX,t.y+=t.velocityY,t.x<0?t.x=r-1:t.x>r-1&&(t.x=0),t.y<0?t.y=h-1:t.y>h-1&&(t.y=0),t.tail.unshift({x:t.x,y:t.y}),t.tail.length>t.maxTail&&t.tail.pop(),d.fillStyle="white",t.tail.forEach(function(e,l){d.fillRect(e.x*o,e.y*o,o,o),e.x===n.x&&e.y===n.y&&(C.play(),t.maxTail++,X.value++,t.tail.push([n.x,n.y]),u());for(let a=l+1;a<t.tail.length;a++)e.x==t.tail[a].x&&e.y==t.tail[a].y&&(D.play(),x.value=!0)}),B())}async function B(){const e=Math.floor(Math.random()*10+120),l=document.createElement("canvas");l.width=i.width,l.height=i.height;const a=l.getContext("2d");a.fillStyle="black",a.fillRect(0,0,i.width,i.height);const s=t.x*o+o/2,g=t.y*o+o/2;let v=a.createRadialGradient(s,g,0,s,g,e);v.addColorStop(0,"rgba(255, 255, 255, 255)"),v.addColorStop(1,"rgba(255, 255, 255, 0)"),a.beginPath(),a.fillStyle=v,a.arc(s,g,e,0,2*Math.PI),a.fill();const w=n.x*o+o/2,S=n.y*o+o/2;let p=a.createRadialGradient(w,S,0,w,S,e/2);p.addColorStop(0,"rgba(255, 255, 255, 255)"),p.addColorStop(1,"rgba(255, 255, 255, 0)"),a.fillStyle=p,a.arc(w,S,e/2,0,2*Math.PI),a.fill();let m=d.getImageData(0,0,i.width,i.height),L=a.getImageData(0,0,l.width,l.height);for(let y=0;y<m.data.length;y+=4){const I=L.data[y]/255;m.data[y]*=I,m.data[y+1]*=I,m.data[y+2]*=I}d.putImageData(m,0,0);let k=d.getImageData(0,0,i.width,i.height);k=z(k,128),d.putImageData(k,0,0)}function z(e,l){const a=[[15,135,45,165],[195,75,225,105],[60,180,30,150],[240,120,210,90]];for(let s=0;s<e.data.length;s+=4){const g=e.data[s]*.299+e.data[s+1]*.587+e.data[s+2]*.114,v=s/4%e.width,w=Math.floor(s/4/e.width),p=Math.floor((g+a[v%4][w%4])/2)<l?0:255;e.data.fill(p,s,s+3)}return e}async function u(){let e=!1;for(;!e;)n.x=Math.floor(Math.random()*r),n.y=Math.floor(Math.random()*h),e=!0,t.tail.forEach(function(l){l.x===n.x&&l.y===n.y&&(e=!1)});n.index=Math.floor(Math.random()*5)}function F(e){(e.code==="ArrowUp"||e.code==="KeyW")&&t.velocityY!=1?(c.velocityX=0,c.velocityY=-1):(e.code==="ArrowDown"||e.code==="KeyS")&&t.velocityY!=-1?(c.velocityX=0,c.velocityY=1):(e.code==="ArrowLeft"||e.code==="KeyA")&&t.velocityX!=1?(c.velocityX=-1,c.velocityY=0):(e.code==="ArrowRight"||e.code==="KeyD")&&t.velocityX!=-1&&(c.velocityX=1,c.velocityY=0),x.value&&e.code==="KeyX"&&H()}async function H(){X.value=0,x.value=!1,t.x=t.y=t.velocityX=t.velocityY=0,t.maxTail=1,t.tail=[],c.velocityX=c.velocityY=0,u()}return(e,l)=>(K(),R("div",j,[q,f("p",J,"Score: "+G(X.value),1),f("p",Q,"Score: "+G(X.value),1),O(x)?(K(),R("div",Z,at)):U("",!0)]))}});export{lt as default};
