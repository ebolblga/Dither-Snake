import{a as V,b as O,r as L,w as E,e as U,f as K,h as M,t as j,i as q,o as T}from"./entry.8a102b98.js";const J={class:"h-full select-none"},Q=M("canvas",{id:"scene",class:"z-0 w-full h-full",style:{"image-rendering":"pixelated"}},null,-1),Z={class:"fixed top-5 right-5 bg-black"},$={key:0},tt=M("p",{class:"fixed top-10 right-5 text-lg bg-black"},"Game over",-1),et=M("p",{class:"fixed top-16 right-5 text-xs bg-black"},"Press X to restart",-1),at=[tt,et],nt=V({__name:"index",async setup(ot){let y,u;O({title:"DitherSnake"});const a=16;let h=Math.floor(window.innerWidth/64),f=Math.floor(window.innerHeight/64),c,d;const b=L(0),v=L(!1),B=10,S=new Image;S.src="./assets/floor.png",[y,u]=E(()=>new Promise(t=>{S.onload=()=>t(1)})),await y,u();const I=new Image;I.src="./assets/food_atlas.png",[y,u]=E(()=>new Promise(t=>{I.onload=()=>t(1)})),await y,u();const k=new Image;k.src="./assets/particle_sprite.png",[y,u]=E(()=>new Promise(t=>{k.onload=()=>t(1)})),await y,u();const P=new Audio("./sfx/food.wav");P.volume=.1;const A=new Audio("./sfx/death.wav");A.volume=.3;const r={startX:0,startY:0,endX:0,endY:0};document.addEventListener("touchstart",t=>{r.startX=t.touches[0].clientX,r.startY=t.touches[0].clientY,r.endX=t.touches[0].clientX,r.endY=t.touches[0].clientY}),document.addEventListener("touchmove",t=>{r.endX=t.touches[0].clientX,r.endY=t.touches[0].clientY}),document.addEventListener("touchend",t=>{let l=r.startX-r.endX,o=r.startY-r.endY;if(Math.abs(o)+Math.abs(l)<20){v.value&&R();return}Math.abs(o)>Math.abs(l)?o>0&&e.velocityY!=1?(n.velocityX=0,n.velocityY=-1):o<=0&&e.velocityY!=-1&&(n.velocityX=0,n.velocityY=1):Math.abs(o)<Math.abs(l)&&(l>0&&e.velocityX!=1?(n.velocityX=-1,n.velocityY=0):l<=0&&e.velocityX!=-1&&(n.velocityX=1,n.velocityY=0))});const n={velocityX:0,velocityY:0},e={x:0,y:0,velocityX:0,velocityY:0,tail:[],maxTail:1},i={index:0,x:1,y:1,particleFrame:0};U(async()=>{c=document.getElementById("scene"),c.height=f*a,c.width=h*a,d=c.getContext("2d"),await m(),document.addEventListener("keydown",W),window.addEventListener("resize",G),setInterval(function(){F()},1e3/B)});function G(){h=Math.floor(window.innerWidth/64),f=Math.floor(window.innerHeight/64),c.height=f*a,c.width=h*a,i.x>h-1&&m(),i.y>f-1&&m(),F()}async function F(){v.value||(d.drawImage(S,0,0,c.width,c.height),d.drawImage(I,i.index*a,0,a,a,i.x*a,i.y*a,a,a),e.velocityX=n.velocityX,e.velocityY=n.velocityY,e.x+=e.velocityX,e.y+=e.velocityY,e.x<0?e.x=h-1:e.x>h-1&&(e.x=0),e.y<0?e.y=f-1:e.y>f-1&&(e.y=0),e.tail.unshift({x:e.x,y:e.y}),e.tail.length>e.maxTail&&e.tail.pop(),d.fillStyle="white",e.tail.forEach(function(t,l){d.fillRect(t.x*a,t.y*a,a,a),t.x===i.x&&t.y===i.y&&(P.play(),e.maxTail++,b.value++,e.tail.push([i.x,i.y]),m());for(let o=l+1;o<e.tail.length;o++)t.x==e.tail[o].x&&t.y==e.tail[o].y&&(A.play(),v.value=!0)}),z())}async function z(){const t=Math.floor(Math.random()*10+120),l=document.createElement("canvas");l.width=c.width,l.height=c.height;const o=l.getContext("2d");o.fillStyle="black",o.fillRect(0,0,c.width,c.height);const s=e.x*a+a/2,w=e.y*a+a/2;let x=o.createRadialGradient(s,w,0,s,w,t);x.addColorStop(0,"rgba(255, 255, 255, 255)"),x.addColorStop(1,"rgba(255, 255, 255, 0)"),o.beginPath(),o.fillStyle=x,o.arc(s,w,t,0,2*Math.PI),o.fill();const p=i.x*a+a/2,_=i.y*a+a/2;let X=o.createRadialGradient(p,_,10,p,_,t/3);X.addColorStop(0,"rgba(255, 255, 255, 255)"),X.addColorStop(1,"rgba(255, 255, 255, 0)"),o.fillStyle=X,o.arc(p,_,t/3,0,2*Math.PI),o.fill();let Y=d.getImageData(0,0,c.width,c.height),N=o.getImageData(0,0,l.width,l.height);for(let g=0;g<Y.data.length;g+=4){const D=N.data[g]/255;Y.data[g]*=D,Y.data[g+1]*=D,Y.data[g+2]*=D}d.putImageData(Y,0,0);let C=d.getImageData(0,0,c.width,c.height);C=H(C,128),d.putImageData(C,0,0),i.particleFrame++,i.particleFrame>25&&(i.particleFrame=0),d.drawImage(k,i.particleFrame*a,0,a,a*2,i.x*a,(i.y-3)*a,a,a*2)}function H(t,l){const o=[[15,135,45,165],[195,75,225,105],[60,180,30,150],[240,120,210,90]];for(let s=0;s<t.data.length;s+=4){const w=t.data[s]*.299+t.data[s+1]*.587+t.data[s+2]*.114,x=s/4%t.width,p=Math.floor(s/4/t.width),X=Math.floor((w+o[x%4][p%4])/2)<l?0:255;t.data.fill(X,s,s+3)}return t}async function m(){let t=!1;for(;!t;)i.x=Math.floor(Math.random()*h),i.y=Math.floor(Math.random()*f),t=!0,e.tail.forEach(function(l){l.x===i.x&&l.y===i.y&&(t=!1)});i.index=Math.floor(Math.random()*5)}function W(t){(t.code==="ArrowUp"||t.code==="KeyW")&&e.velocityY!=1?(n.velocityX=0,n.velocityY=-1):(t.code==="ArrowDown"||t.code==="KeyS")&&e.velocityY!=-1?(n.velocityX=0,n.velocityY=1):(t.code==="ArrowLeft"||t.code==="KeyA")&&e.velocityX!=1?(n.velocityX=-1,n.velocityY=0):(t.code==="ArrowRight"||t.code==="KeyD")&&e.velocityX!=-1&&(n.velocityX=1,n.velocityY=0),v.value&&t.code==="KeyX"&&R()}async function R(){b.value=0,v.value=!1,e.x=e.y=e.velocityX=e.velocityY=0,e.maxTail=1,e.tail=[],n.velocityX=n.velocityY=0,m()}return(t,l)=>(T(),K("div",J,[Q,M("p",Z,"Score: "+j(b.value),1),v.value?(T(),K("div",$,at)):q("",!0)]))}});export{nt as default};
