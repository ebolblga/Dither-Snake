import{a as N,b as V,r as E,w as D,e as O,f as R,h as X,t as U,i as j,o as K}from"./entry.955d16d1.js";const q={class:"h-full select-none"},J=X("canvas",{id:"scene",class:"z-0 w-full h-full",style:{"image-rendering":"pixelated"}},null,-1),Q={class:"fixed top-5 right-5 bg-black"},Z={key:0},$=X("p",{class:"fixed top-10 right-5 text-lg bg-black"},"Game over",-1),tt=X("p",{class:"fixed top-16 right-5 text-xs bg-black"},"Press X to restart",-1),et=[$,tt],it=N({__name:"index",async setup(at){let f,y;V({title:"DitherSnake"});const a=16;let d=Math.floor(window.innerWidth/64),h=Math.floor(window.innerHeight/64),n,r;const b=E(0),u=E(!1),T=10,S=new Image;S.src="./assets/floor.png",[f,y]=D(()=>new Promise(t=>{S.onload=()=>t(1)})),await f,y();const I=new Image;I.src="./assets/food_atlas.png",[f,y]=D(()=>new Promise(t=>{I.onload=()=>t(1)})),await f,y();const Y=new Image;Y.src="./assets/particle_sprite.png",[f,y]=D(()=>new Promise(t=>{Y.onload=()=>t(1)})),await f,y();const P=new Audio("./sfx/food.wav");P.volume=.1;const A=new Audio("./sfx/death.wav");A.volume=.3;const c={velocityX:0,velocityY:0},e={x:0,y:0,velocityX:0,velocityY:0,tail:[],maxTail:1},o={index:0,x:1,y:1,particleFrame:0};O(async()=>{n=document.getElementById("scene"),n.height=h*a,n.width=d*a,r=n.getContext("2d"),await w(),document.addEventListener("keydown",H),window.addEventListener("resize",B),setInterval(function(){F()},1e3/T)});function B(){d=Math.floor(window.innerWidth/64),h=Math.floor(window.innerHeight/64),n.height=h*a,n.width=d*a,o.x>d-1&&w(),o.y>h-1&&w(),F()}async function F(){u.value||(r.drawImage(S,0,0,n.width,n.height),r.drawImage(I,o.index*a,0,a,a,o.x*a,o.y*a,a,a),e.velocityX=c.velocityX,e.velocityY=c.velocityY,e.x+=e.velocityX,e.y+=e.velocityY,e.x<0?e.x=d-1:e.x>d-1&&(e.x=0),e.y<0?e.y=h-1:e.y>h-1&&(e.y=0),e.tail.unshift({x:e.x,y:e.y}),e.tail.length>e.maxTail&&e.tail.pop(),r.fillStyle="white",e.tail.forEach(function(t,l){r.fillRect(t.x*a,t.y*a,a,a),t.x===o.x&&t.y===o.y&&(P.play(),e.maxTail++,b.value++,e.tail.push([o.x,o.y]),w());for(let i=l+1;i<e.tail.length;i++)t.x==e.tail[i].x&&t.y==e.tail[i].y&&(A.play(),u.value=!0)}),G())}async function G(){const t=Math.floor(Math.random()*10+120),l=document.createElement("canvas");l.width=n.width,l.height=n.height;const i=l.getContext("2d");i.fillStyle="black",i.fillRect(0,0,n.width,n.height);const s=e.x*a+a/2,x=e.y*a+a/2;let v=i.createRadialGradient(s,x,0,s,x,t);v.addColorStop(0,"rgba(255, 255, 255, 255)"),v.addColorStop(1,"rgba(255, 255, 255, 0)"),i.beginPath(),i.fillStyle=v,i.arc(s,x,t,0,2*Math.PI),i.fill();const m=o.x*a+a/2,M=o.y*a+a/2;let p=i.createRadialGradient(m,M,10,m,M,t/3);p.addColorStop(0,"rgba(255, 255, 255, 255)"),p.addColorStop(1,"rgba(255, 255, 255, 0)"),i.fillStyle=p,i.arc(m,M,t/3,0,2*Math.PI),i.fill();let _=r.getImageData(0,0,n.width,n.height),W=i.getImageData(0,0,l.width,l.height);for(let g=0;g<_.data.length;g+=4){const C=W.data[g]/255;_.data[g]*=C,_.data[g+1]*=C,_.data[g+2]*=C}r.putImageData(_,0,0);let k=r.getImageData(0,0,n.width,n.height);k=z(k,128),r.putImageData(k,0,0),o.particleFrame++,o.particleFrame>25&&(o.particleFrame=0),r.drawImage(Y,o.particleFrame*a,0,a,a*2,o.x*a,(o.y-3)*a,a,a*2)}function z(t,l){const i=[[15,135,45,165],[195,75,225,105],[60,180,30,150],[240,120,210,90]];for(let s=0;s<t.data.length;s+=4){const x=t.data[s]*.299+t.data[s+1]*.587+t.data[s+2]*.114,v=s/4%t.width,m=Math.floor(s/4/t.width),p=Math.floor((x+i[v%4][m%4])/2)<l?0:255;t.data.fill(p,s,s+3)}return t}async function w(){let t=!1;for(;!t;)o.x=Math.floor(Math.random()*d),o.y=Math.floor(Math.random()*h),t=!0,e.tail.forEach(function(l){l.x===o.x&&l.y===o.y&&(t=!1)});o.index=Math.floor(Math.random()*5)}function H(t){(t.code==="ArrowUp"||t.code==="KeyW")&&e.velocityY!=1?(c.velocityX=0,c.velocityY=-1):(t.code==="ArrowDown"||t.code==="KeyS")&&e.velocityY!=-1?(c.velocityX=0,c.velocityY=1):(t.code==="ArrowLeft"||t.code==="KeyA")&&e.velocityX!=1?(c.velocityX=-1,c.velocityY=0):(t.code==="ArrowRight"||t.code==="KeyD")&&e.velocityX!=-1&&(c.velocityX=1,c.velocityY=0),u.value&&t.code==="KeyX"&&L()}async function L(){b.value=0,u.value=!1,e.x=e.y=e.velocityX=e.velocityY=0,e.maxTail=1,e.tail=[],c.velocityX=c.velocityY=0,w()}return(t,l)=>(K(),R("div",q,[J,X("p",Q,"Score: "+U(b.value),1),u.value?(K(),R("div",Z,et)):j("",!0)]))}});export{it as default};
