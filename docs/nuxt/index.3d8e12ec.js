import{a as Q,b as Z,r as M,w as K,e as $,f as z,h as C,t as tt,i as et,j as ot,o as H}from"./entry.060edb09.js";const at={class:"h-full select-none"},it=C("canvas",{id:"scene",class:"z-0 w-full h-full",style:{"image-rendering":"pixelated"}},null,-1),nt={class:"fixed top-5 right-5 bg text"},lt={key:0},dt=C("p",{class:"fixed top-10 right-5 text-lg bg text"},"Game over",-1),rt=C("p",{class:"fixed top-16 right-5 text-xs bg text"},"Press X to restart",-1),st=[dt,rt],ft=Q({__name:"index",async setup(ct){let m,b;ot(t=>({"3088981b":L.value,"707db61a":P.value})),Z({title:"DitherSnake"});const o=16;let p=Math.floor(window.innerWidth/64),w=Math.floor(window.innerHeight/64),n,a;const I=M(0),_=M(!1),V=10,L=M("rgb(0, 0, 0)"),P=M("rgb(255, 255, 255)"),i={index:0,light:[[255,255,255],[244,78,56],[199,199,199],[195,220,229],[237,246,214],[235,229,206],[114,164,136],[34,35,35]],dark:[[0,0,0],[29,15,68],[20,23,36],[17,12,34],[62,35,44],[46,48,55],[33,44,40],[240,246,240]]},u={startX:0,startY:0,endX:0,endY:0},T=new Image;T.src="./assets/floor_texture.png",[m,b]=K(()=>new Promise(t=>{T.onload=()=>t(1)})),await m,b();const D=new Image;D.src="./assets/food_atlas.png",[m,b]=K(()=>new Promise(t=>{D.onload=()=>t(1)})),await m,b();const E=new Image;E.src="./assets/particle_sprite.png",[m,b]=K(()=>new Promise(t=>{E.onload=()=>t(1)})),await m,b();const O=new Audio("./sfx/food.wav");O.volume=.1;const B=new Audio("./sfx/death.wav");B.volume=.3,document.addEventListener("touchstart",t=>{u.startX=t.touches[0].clientX,u.startY=t.touches[0].clientY,u.endX=t.touches[0].clientX,u.endY=t.touches[0].clientY}),document.addEventListener("touchmove",t=>{u.endX=t.touches[0].clientX,u.endY=t.touches[0].clientY}),document.addEventListener("touchend",t=>{let h=u.startX-u.endX,s=u.startY-u.endY;if(Math.abs(s)+Math.abs(h)<20){_.value&&W();return}Math.abs(s)>Math.abs(h)?s>0&&e.velocityY!=1?(d.velocityX=0,d.velocityY=-1):s<=0&&e.velocityY!=-1&&(d.velocityX=0,d.velocityY=1):Math.abs(s)<Math.abs(h)&&(h>0&&e.velocityX!=1?(d.velocityX=-1,d.velocityY=0):h<=0&&e.velocityX!=-1&&(d.velocityX=1,d.velocityY=0))});const d={velocityX:0,velocityY:0},e={x:0,y:0,velocityX:0,velocityY:0,tail:[],maxTail:1},l={index:0,x:1,y:1,particleFrame:0};$(async()=>{n=document.getElementById("scene"),n.height=w*o,n.width=p*o,a=n.getContext("2d"),await X(),document.addEventListener("keydown",q),window.addEventListener("resize",N),setInterval(function(){G()},1e3/V)});function N(){p=Math.floor(window.innerWidth/64),w=Math.floor(window.innerHeight/64),n.height=w*o,n.width=p*o,l.x>p-1&&X(),l.y>w-1&&X(),G()}async function G(){_.value||(a.drawImage(T,0,0,n.width,n.height),a.drawImage(D,l.index*o,0,o,o,l.x*o,l.y*o,o,o),e.velocityX=d.velocityX,e.velocityY=d.velocityY,e.x+=e.velocityX,e.y+=e.velocityY,e.x<0?e.x=p-1:e.x>p-1&&(e.x=0),e.y<0?e.y=w-1:e.y>w-1&&(e.y=0),e.tail.unshift({x:e.x,y:e.y}),e.tail.length>e.maxTail&&e.tail.pop(),a.fillStyle="white",e.tail.forEach(function(t,h){a.fillRect(t.x*o,t.y*o,o,o),t.x===l.x&&t.y===l.y&&(O.play(),e.maxTail++,I.value++,e.tail.push([l.x,l.y]),X());for(let s=h+1;s<e.tail.length;s++)t.x==e.tail[s].x&&t.y==e.tail[s].y&&(B.play(),_.value=!0)}),j())}async function j(){const s=Math.floor(Math.random()*10+160),r=document.createElement("canvas");r.width=n.width,r.height=n.height;const f=r.getContext("2d");f.fillStyle="black",f.fillRect(0,0,n.width,n.height);const Y=e.x*o+o/2,k=e.y*o+o/2;let y=f.createRadialGradient(Y,k,0,Y,k,s);y.addColorStop(0,"rgba(255, 255, 255, 255)"),y.addColorStop(.1,"rgba(206, 206, 206, 206)"),y.addColorStop(.2,"rgba(163, 163, 163, 163)"),y.addColorStop(.3,"rgba(125, 125, 125, 125)"),y.addColorStop(.4,"rgba(92, 92, 92, 92)"),y.addColorStop(.5,"rgba(64, 64, 64, 64)"),y.addColorStop(.6,"rgba(41, 41, 41, 41)"),y.addColorStop(.7,"rgba(23, 23, 23, 23)"),y.addColorStop(.8,"rgba(10, 10, 10, 10)"),y.addColorStop(.9,"rgba(2, 2, 2, 2)"),y.addColorStop(1,"rgba(0, 0, 0, 0)"),f.beginPath(),f.fillStyle=y,f.arc(Y,k,s,0,2*Math.PI),f.fill();const g=l.x*o+o/2,v=l.y*o+o/2;let A=f.createRadialGradient(g,v,8,g,v,s/4);A.addColorStop(0,"rgba(255, 255, 255, 255)"),A.addColorStop(1,"rgba(255, 255, 255, 0)"),f.fillStyle=A,f.arc(g,v,s/3,0,2*Math.PI),f.fill();let S=a.getImageData(0,0,n.width,n.height),J=f.getImageData(0,0,r.width,r.height);for(let c=0;c<S.data.length;c+=4){const R=J.data[c]/255;S.data[c]*=R,S.data[c+1]*=R,S.data[c+2]*=R}a.putImageData(S,0,0);let F=a.getImageData(0,0,n.width,n.height);F=U(F,128),a.putImageData(F,0,0),l.particleFrame++,l.particleFrame>25&&(l.particleFrame=0),a.drawImage(E,l.particleFrame*o,0,o,o*2,l.x*o,(l.y-3)*o,o,o*2);const x=Math.floor(s/4);if(a.strokeStyle=P.value,a.lineWidth=2,g+x>n.width){let c=g+x-n.width;a.beginPath(),a.moveTo(n.width,v-c),a.lineTo(n.width,v+c),a.stroke()}if(g-x<0){let c=g-x;a.beginPath(),a.moveTo(0,v-c),a.lineTo(0,v+c),a.stroke()}if(v+x>n.height){let c=v+x-n.height;a.beginPath(),a.moveTo(g-c,n.height),a.lineTo(g+c,n.height),a.stroke()}if(v-x<0){let c=v-x;a.beginPath(),a.moveTo(g-c,0),a.lineTo(g+c,0),a.stroke()}}function U(t,h){const s=[[15,135,45,165],[195,75,225,105],[60,180,30,150],[240,120,210,90]];for(let r=0;r<t.data.length;r+=4){const f=t.data[r]*.299+t.data[r+1]*.587+t.data[r+2]*.114,Y=r/4%t.width,k=Math.floor(r/4/t.width);Math.floor((f+s[Y%4][k%4])/2)>=h?(t.data[r]=i.light[i.index][0],t.data[r+1]=i.light[i.index][1],t.data[r+2]=i.light[i.index][2]):(t.data[r]=i.dark[i.index][0],t.data[r+1]=i.dark[i.index][1],t.data[r+2]=i.dark[i.index][2])}return t}async function X(){let t=!1;for(;!t;)l.x=Math.floor(Math.random()*p),l.y=Math.floor(Math.random()*w),t=!0,e.tail.forEach(function(h){h.x===l.x&&h.y===l.y&&(t=!1)});l.index=Math.floor(Math.random()*5)}function q(t){(t.code==="ArrowUp"||t.code==="KeyW")&&e.velocityY!=1?(d.velocityX=0,d.velocityY=-1):(t.code==="ArrowDown"||t.code==="KeyS")&&e.velocityY!=-1?(d.velocityX=0,d.velocityY=1):(t.code==="ArrowLeft"||t.code==="KeyA")&&e.velocityX!=1?(d.velocityX=-1,d.velocityY=0):(t.code==="ArrowRight"||t.code==="KeyD")&&e.velocityX!=-1&&(d.velocityX=1,d.velocityY=0),_.value&&t.code==="KeyX"&&W(),t.code==="KeyC"&&(i.index++,i.index>=i.light.length&&(i.index=0),L.value="rgb("+i.dark[i.index][0]+", "+i.dark[i.index][1]+", "+i.dark[i.index][2]+")",P.value="rgb("+i.light[i.index][0]+", "+i.light[i.index][1]+", "+i.light[i.index][2]+")")}async function W(){I.value=0,_.value=!1,e.x=e.y=e.velocityX=e.velocityY=0,e.maxTail=1,e.tail=[],d.velocityX=d.velocityY=0,X()}return(t,h)=>(H(),z("div",at,[it,C("p",nt,"Score: "+tt(I.value),1),_.value?(H(),z("div",lt,st)):et("",!0)]))}});export{ft as default};
